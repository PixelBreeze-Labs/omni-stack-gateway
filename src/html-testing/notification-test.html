<!DOCTYPE html>
<html>
<head>
    <title>OneSignal Web Notification Test</title>
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
</head>
<body>
<h1>OneSignal Web Notification Test</h1>
<p>User ID: <span id="userId">Not subscribed yet</span></p>
<button id="subscribeButton">Subscribe to Notifications</button>

<script>
    window.OneSignal = window.OneSignal || [];
    OneSignal.push(function() {
        OneSignal.init({
            appId: "YOUR_ONESIGNAL_APP_ID",
            allowLocalhostAsSecureOrigin: true,
        });

        // Check if already subscribed
        OneSignal.isPushNotificationsEnabled().then(function(isEnabled) {
            if (isEnabled) {
                console.log("Push notifications are enabled!");
                displayUserId();
            }
        });

        // Handle subscription button
        document.getElementById('subscribeButton').addEventListener('click', function() {
            OneSignal.registerForPushNotifications();
            OneSignal.setSubscription(true);
        });

        // Show OneSignal User ID when available
        OneSignal.on('subscriptionChange', function (isSubscribed) {
            if (isSubscribed) {
                displayUserId();
            }
        });
    });

    function displayUserId() {
        OneSignal.getUserId().then(function(userId) {
            document.getElementById('userId').textContent = userId;
            console.log("OneSignal User ID:", userId);

            // Optional: Send this to your backend
            // registerWithBackend(userId);
        });
    }

    function registerWithBackend(oneSignalId) {
        // You can add code here to call your backend API
        // to register this browser with a test user
        fetch('http://localhost:3000/core-notifications/register-device', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer YOUR_JWT_TOKEN',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                deviceToken: oneSignalId,
                platform: 'web',
                userId: 'YOUR_TEST_USER_ID'
            })
        })
            .then(response => response.json())
            .then(data => console.log('Registered with backend:', data))
            .catch(error => console.error('Error registering with backend:', error));
    }
</script>
</body>
</html>